<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Hat Rider - Calculamatrise</title>
    <link rel="stylesheet" href="styles/default.css">
    <link rel="stylesheet" href="styles/dark.css" id="theme">
</head>
<body>
    <bhr-game-container>
        <canvas id="view" width="900" height="500"></canvas>
		<bhr-game-interface>
            <bhr-game-toolbar>
                <section class="left">
					<label class="toolbar-item playpause" title="Pause/Play - Space">
						<input type="checkbox" style="display: none;" onchange="window.game.scene.paused = !this.checked" checked>
					</label>
                    <button class="toolbar-item backtrack" title="Checkpoint - Enter" onclick="window.game.scene.gotoCheckpoint()"></button>
                    <button class="toolbar-item rewind" title="Cancel Checkpoint - Backspace" onclick="window.game.scene.removeCheckpoint()"></button>
                    <br>
                    <button class="toolbar-item wheel" title="Change Vehicle - Ctrl + B"  onclick="window.game.scene.switchBike()">
						<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 25 25" style="stroke: #777;">
							<circle cx="12.5" cy="12.5" r="10"style="fill: none;stroke: var(--text-color);stroke-width: 2.5;" />
							<line x1="12.5" y1="12.5" x2="20.5" y2="12.5"/>
							<line x1="12.5" y1="12.5" x2="19.42820323027551" y2="16.5"/>
							<line x1="12.5" y1="12.5" x2="16.5" y2="19.428203230275507"/>
							<line x1="12.5" y1="12.5" x2="12.5" y2="20.5"/>
							<line x1="12.5" y1="12.5" x2="8.500000000000002" y2="19.42820323027551"/>
							<line x1="12.5" y1="12.5" x2="5.57179676972449" y2="16.5"/>
							<line x1="12.5" y1="12.5" x2="4.5" y2="12.500000000000002"/>
							<line x1="12.5" y1="12.5" x2="5.571796769724491" y2="8.5"/>
							<line x1="12.5" y1="12.5" x2="8.499999999999996" y2="5.571796769724492"/>
							<line x1="12.5" y1="12.5" x2="12.499999999999998" y2="4.5"/>
							<line x1="12.5" y1="12.5" x2="16.5" y2="5.571796769724491"/>
							<line x1="12.5" y1="12.5" x2="19.428203230275507" y2="8.499999999999996"/>
						</svg>
                    </button>
                    <br>
                    <button class="toolbar-item fullscreen" title="Fullscreen - F" style="border-bottom: 1px solid var(--border-color);border-bottom-right-radius: 5px;" onclick="document.fullscreenElement ? document.exitFullscreen() : window.game.container.requestFullscreen()"></button>
                    <div class="editor-tools" style="display: block;">
						<button class="toolbar-item" title="Undo - Ctrl + Z" style="border-top-right-radius: 5px;" onclick="window.game.scene.history.undo();">↺</button>
                        <button class="toolbar-item" title="Redo - Ctrl + Shift + Z" style="border-bottom: 1px solid var(--border-color);border-bottom-right-radius: 5px;" onclick="window.game.scene.history.redo();">↻</button>
					</div>
					<div class="tool-settings">
                        <button class="toolbar-item increment" title="Increase length - A + Scroll" style="border-top-right-radius: 5px;" onclick="window.game.scene.toolHandler.selected === 'eraser' ? window.game.scene.toolHandler.currentTool.size < 500 && (window.game.scene.toolHandler.currentTool.size += 5) : window.game.scene.toolHandler.currentTool.length < 200 && (window.game.scene.toolHandler.currentTool.length += 8);"></button>
                        <button class="toolbar-item decrement" title="Decrease length - A + Scroll" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-right-radius: 5px;" onclick="window.game.scene.toolHandler.selected === 'eraser' ? window.game.scene.toolHandler.currentTool.size > 10 && (window.game.scene.toolHandler.currentTool.size -= 5) : window.game.scene.toolHandler.currentTool.length > 4 && (window.game.scene.toolHandler.currentTool.length -= 8);"></button>
                        <div data-id="eraser">
                            <label class="toolbar-item brush" title="Erase physical lines - Enabled" style="border-top-width: 1px;border-top-style: solid;border-top-right-radius: 5px;">
								<input type="checkbox" style="display: none;" onchange="window.game.scene.toolHandler.currentTool.ignoring[window.game.scene.toolHandler.currentTool.ignoring.has('physics') ? 'delete' : 'add']('physics');" checked>
							</label>
                            <label class="toolbar-item scenery brush" title="Erase visual lines - Enabled">
								<input type="checkbox" style="display: none;" onchange="window.game.scene.toolHandler.currentTool.ignoring[window.game.scene.toolHandler.currentTool.ignoring.has('scenery') ? 'delete' : 'add']('scenery');" checked>
							</label>
                            <label class="toolbar-item powerup target" title="Erase powerups - Enabled" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-right-radius: 5px;">
								<input type="checkbox" style="display: none;" onchange="window.game.scene.toolHandler.currentTool.ignoring[window.game.scene.toolHandler.currentTool.ignoring.has('powerups') ? 'delete' : 'add']('powerups')" checked>
							</label>
                        </div>
                    </div>
                </section>
                <section class="right">
                    <label class="toolbar-item brush" title="Brush - A" onclick="window.game.scene.toolHandler.setTool('brush', false)">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item scenery brush" title="Scenery Brush - S" onclick="window.game.scene.toolHandler.setTool('brush', true)">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item line" title="Line - Q" onclick="window.game.scene.toolHandler.setTool('line', false)">
						<input type="radio" name="tool" style="display: none;" checked>
					</label>
                    <label class="toolbar-item scenery line" title="Scenery Line - W" onclick="window.game.scene.toolHandler.setTool('line', true)">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item eraser" title="Eraser - E" onclick="window.game.scene.toolHandler.setTool('eraser')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item camera" title="Camera - R" onclick="window.game.scene.toolHandler.setTool('camera')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item grid" title="Grid - G" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-left-radius: 5px;">
						<input type="checkbox" style="display: none;" onchange="window.game.scene.grid.size = 11 - window.game.scene.grid.size;">
					</label>
                    <br>
                    <label class="toolbar-item powerup target" title="Goal" style="border-top-width: 1px;border-top-style: solid;border-top-left-radius: 5px;" onclick="window.game.scene.toolHandler.setTool('goal')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup checkpoint" title="Checkpoint" onclick="window.game.scene.toolHandler.setTool('checkpoint')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup triangle boost" title="Booster" onclick="window.game.scene.toolHandler.setTool('boost')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup triangle gravity" title="Gravity" onclick="window.game.scene.toolHandler.setTool('gravity')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup bomb" title="Bomb" onclick="window.game.scene.toolHandler.setTool('bomb')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup slowmo" title="Slow-motion" onclick="window.game.scene.toolHandler.setTool('slow-mo')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup antigravity" title="Anti-gravity" onclick="window.game.scene.toolHandler.setTool('antigravity')">
						<input type="radio" name="tool" style="display: none;">
					</label>
                    <label class="toolbar-item powerup teleport" title="Teleporter" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-left-radius: 5px;" onclick="window.game.scene.toolHandler.setTool('teleporter')">
						<input type="radio" name="tool" style="display: none;">
					</label>
					<br>
					<br>
					<label for="settings-overlay" class="toolbar-item" style="border-bottom-width: 1px;border-bottom-style: solid;border-bottom-left-radius: 5px;border-top-width: 1px;border-top-style: solid;border-top-left-radius: 5px;position: absolute;z-index: 1;">⚙</label>
				</section>
            </bhr-game-toolbar>
			<div class="bhr-game-overlay" style="display: none;">
				<input type="checkbox" id="settings-overlay" style="display: none;">
                <nav>
                    <label for="track">Track</label>
                    <label for="ghost">Ghost</label>
                    <label for="settings">Settings</label>
                    <label for="appearance">Appearance</label>
                </nav>
                <section>
					<input type="radio" name="bhr-game-overlay-nav" id="track" style="display: none;" checked>
                    <button onclick="game.reset()">Clear</button>
                    <button onclick="game.load(document.querySelector('textarea#code').value)">Load</button>
                    <button onclick="game.load()">Load File...</button>
                    <button onclick="document.querySelector('textarea#code').value = game.scene.toString()">Save</button>
                    <button onclick="game.saveAs()">Save As...</button>
                    <textarea id="code" cols="30" rows="10" ondrop="Promise.all([...event.dataTransfer.items].filter(({ kind }) => kind === 'file').map(item => item.getAsFileSystemHandle())).then(fileHandles => game.loadFile({ fileHandles }));" onkeydown="event.stopPropagation()"></textarea>
				</section>
                <section style="display: none;">
					<input type="radio" name="bhr-game-overlay-nav" id="ghost" style="display: none;">
                    <button onclick="game.scene.players.splice(1, game.scene.players.length)">Clear Ghosts</button>
                    <button onclick="game.scene.watchGhost(document.querySelector('textarea#gcode').value), document.querySelector('game-overlay').style.setProperty('display', 'none')">Load</button>
                    <button onclick="
                        let picker = document.createElement('input');
                        picker.type = 'file';
                        picker.accept = 'text/plain';
                        picker.addEventListener('change', function(event) {
                            const reader = new FileReader();
                            reader.addEventListener('load', function() {
                                game.scene.watchGhost(this.result);
                            });
                            reader.readAsText(this.files[0]);
                        });
                        picker.click();
                    ">Load File...</button>
                    <button onclick="document.querySelector('textarea#gcode').value = game.scene.firstPlayer.records.map(record => [...record].join(' ')).join(',') + ',' + game.scene.firstPlayer.vehicle.name">Save</button>
                    <button onclick="
                        let link = document.createElement('a');
                        file = new Blob([
                            game.scene.firstPlayer.records.map(record => [...record].join(' ')).join(',')
                        ], {
                            type: 'text/plain'
                        });
                        link.href = window.URL.createObjectURL(file);
                        link.download = 'bhr_ghost_' + new Date(new Date().setHours(new Date().getHours() - new Date().getTimezoneOffset() / 60)).toISOString().split(/t/i).join('_').replace(/\..+/, '').replace(/:/g, '-');
                        link.click();
                    ">Save As...</button>
                    <textarea id="gcode" cols="30" rows="10" onkeydown="event.stopPropagation()"></textarea>
				</section>
                <section style="display: none;">
					<input type="radio" name="bhr-game-overlay-nav" id="settings" style="display: none;">
                    <label for="auto-pause">Auto pause<input type="checkbox" id="auto-pause"></label>
                </section>
                <section style="display: none;">
					<input type="radio" name="bhr-game-overlay-nav" id="appearance" style="display: none;">
                    <button onclick="game.settings.theme = 'light', document.querySelector('link#theme').href = 'styles/light.css', window.game.scene.grid.sectors.forEach(sector => sector.rendered = false);">Light</button>
                    <button onclick="game.settings.theme = 'midnight', document.querySelector('link#theme').href = 'styles/dark.css', window.game.scene.grid.sectors.forEach(sector => sector.rendered = false);">Midnight</button>
                    <button onclick="game.settings.theme = 'dark', document.querySelector('link#theme').href = 'styles/dark.css', window.game.scene.grid.sectors.forEach(sector => sector.rendered = false);">Dark</button>
                </section>
				<button style="max-width: 25vmin;" onclick="window.close()">Exit to desktop</button>
            </div>
        </bhr-game-interface>
    </bhr-game-container>
    <script type="module" src="bootstrap.js"></script>
    <script type="module">
		game.init("-18 1i 18 1i###BMX");
	</script>
</body>
</html>